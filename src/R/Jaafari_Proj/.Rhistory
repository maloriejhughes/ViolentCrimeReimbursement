x <- c( "State","Num. Claims Processed","Num. Claims Paid","Percent Claims Unpaid")
y <- sprintf("{point.%s}", c( "State","total_processed","total_num_paid","percent_unpaid"))
tltip <- tooltip_table(x, y)
#highchart()%>%
hchart(top_three_per_state, "column", hcaes(x = County,
y =percent_unpaid,group=State    )) %>%
hc_yAxis( title = list(text = "100*(Total Unpaid)/(Total Processed)")) %>%
hc_xAxis(title = list(text = " "),type="category" )%>%
hc_tooltip(useHTML = TRUE, headerFormat = "", pointFormat = tltip)%>%
hc_plotOptions(column = list( itemStyle=list( fillOpacity = 0.1)))%>%
hc_title(text="Percent of Processed Cases that went Unpaid")   %>%
hc_legend(enabled = FALSE, itemStyle=list(  opacity = 0.75,fontWeight="regular"))
hchart(top_three_per_state, "column", hcaes(x = county_state,
y =percent_unpaid,group=State    )) %>%
hc_yAxis( title = list(text = "100*(Total Unpaid)/(Total Processed)")) %>%
hc_xAxis(title = list(text = " "),type="category" )%>%
hc_tooltip(useHTML = TRUE, headerFormat = "", pointFormat = tltip)%>%
hc_plotOptions(column = list( itemStyle=list( fillOpacity = 0.1)))%>%
hc_title(text="Percent of Processed Cases that went Unpaid")   %>%
hc_legend(enabled = FALSE, itemStyle=list(  opacity = 0.75,fontWeight="regular"))
categories_grouped <- map(unique(Category), function(x){
list(name = x,categories = SubCategory[Category == x])
})
x <- c( "State","Num. Claims Processed","Num. Claims Paid","Percent Claims Unpaid")
y <- sprintf("{point.%s}", c( "State","total_processed","total_num_paid","percent_unpaid"))
tltip <- tooltip_table(x, y)
#highchart()%>%
hchart(top_three_per_state, "column", hcaes(x = county_state,
y =percent_unpaid,group=State    )) %>%
hc_yAxis( title = list(text = "100*(Total Unpaid)/(Total Processed)")) %>%
hc_xAxis(title = list(text = " "),type="category" )%>%
hc_tooltip(useHTML = TRUE, headerFormat = "", pointFormat = tltip)%>%
hc_plotOptions(column = list( itemStyle=list( fillOpacity = 0.1)))%>%
hc_title(text="Percent of Processed Cases that went Unpaid")   %>%
hc_legend(enabled = FALSE, itemStyle=list(  opacity = 0.75,fontWeight="regular"))
hchart(top_three_per_state, "column", hcaes(x = County,
y =percent_unpaid,group=State    )) %>%
hc_yAxis( title = list(text = "100*(Total Unpaid)/(Total Processed)")) %>%
hc_xAxis(title = list(text = " "),type="category" )%>%
hc_tooltip(useHTML = TRUE, headerFormat = "", pointFormat = tltip)%>%
hc_plotOptions(column = list( itemStyle=list( fillOpacity = 0.1)))%>%
hc_title(text="Percent of Processed Cases that went Unpaid")   %>%
hc_legend(enabled = TRUE, itemStyle=list(  opacity = 0.75,fontWeight="regular"))
#knitr::opts_chunk$set(echo = TRUE)
library(readr)
library(tidyverse)
library(stargazer)
library(highcharter)
RAW_PATH<-"~/Documents/2018/02_Jaafari_Proj/DATA/RAW/"
data<-read_csv(paste0(RAW_PATH,"VCAP_STATE_TOTALS_MASTER.csv"))
highchart()%>%
hc_add_series(top_three_per_state, "column", hcaes(x = County,
y =percent_unpaid,group=State    )) %>%
hc_yAxis( title = list(text = "100*(Total Unpaid)/(Total Processed)")) %>%
hc_xAxis(title = list(text = " "),type="category" )%>%
hc_tooltip(useHTML = TRUE, headerFormat = "", pointFormat = tltip)%>%
hc_plotOptions(column = list( itemStyle=list( fillOpacity = 0.1)))%>%
hc_title(text="Top Three Counties per State: Percent Unpaid Claims")   %>%
hc_legend(enabled = TRUE, itemStyle=list(  opacity = 0.75,fontWeight="regular"))
highchart()%>%
hc_add_series(top_three_per_state, "column", hcaes(x = County,
y =percent_unpaid,group=State    )) %>%
hc_yAxis( title = list(text = "100*(Total Unpaid)/(Total Processed)")) %>%
hc_xAxis(title = list(text = " "),type="category" )%>%
hc_tooltip(useHTML = TRUE, headerFormat = "", pointFormat = tltip)%>%
# hc_plotOptions(column = list( itemStyle=list( fillOpacity = 0.1)))%>%
hc_title(text="Top Three Counties per State: Percent Unpaid Claims")   %>%
hc_legend(enabled = TRUE, itemStyle=list(  opacity = 0.75,fontWeight="regular"))
highchart()%>%
hc_add_series(top_three_per_state, "column", hcaes(x = County,
y =percent_unpaid,group=State    )) %>%
hc_yAxis( title = list(text = "100*(Total Unpaid)/(Total Processed)")) %>%
hc_xAxis(title = list(text = " "),type="category" )%>%
hc_tooltip(useHTML = TRUE, headerFormat = "", pointFormat = tltip)%>%
hc_title(text="Top Three Counties per State: Percent Unpaid Claims")   %>%
hc_legend(enabled = TRUE, itemStyle=list(  opacity = 0.75,fontWeight="regular"))
top_three_per_state<-data.county%>%filter(percent_unpaid!="-Inf") %>% group_by(State) %>%
top_n(n = 3, wt = percent_unpaid) #mutate(County=as.character(County))
x <- c( "State","Num. Claims Processed","Num. Claims Paid","Percent Claims Unpaid")
y <- sprintf("{point.%s}", c( "State","total_processed","total_num_paid","percent_unpaid"))
tltip <- tooltip_table(x, y)
plot2<-highchart()%>%
hc_add_series(top_three_per_state, "column", hcaes(x = County,
y =percent_unpaid,group=State    )) %>%
hc_yAxis( title = list(text = "100*(Total Unpaid)/(Total Processed)")) %>%
hc_xAxis(title = list(text = " "),type="category" )%>%
hc_tooltip(useHTML = TRUE, headerFormat = "", pointFormat = tltip)%>%
hc_title(text="Top Three Counties per State: Percent Unpaid Claims")   %>%
hc_legend(enabled = TRUE, itemStyle=list(  opacity = 0.75,fontWeight="regular"))
plot2
top_five_per_state<-data.county%>%filter(percent_unpaid!="-Inf") %>% group_by(State) %>%
top_n(n = 5, wt = percent_unpaid) #mutate(County=as.character(County))
x <- c( "State","Num. Claims Processed","Num. Claims Paid","Percent Claims Unpaid")
y <- sprintf("{point.%s}", c( "State","total_processed","total_num_paid","percent_unpaid"))
tltip <- tooltip_table(x, y)
plot2<-highchart()%>%
hc_add_series(top_five_per_state, "column", hcaes(x = County,
y =percent_unpaid,group=State    )) %>%
hc_yAxis( title = list(text = "100*(Total Unpaid)/(Total Processed)")) %>%
hc_xAxis(title = list(text = " "),type="category" )%>%
hc_tooltip(useHTML = TRUE, headerFormat = "", pointFormat = tltip)%>%
hc_title(text="Top Three Counties per State: Percent Unpaid Claims")   %>%
hc_legend(enabled = TRUE, itemStyle=list(  opacity = 0.75,fontWeight="regular"))
plot2
highchart()%>%
hc_add_series(top_five_per_state, "bar", hcaes(x = county_state,
y =percent_unpaid,group=State    )) %>%
hc_yAxis( title = list(text = "100*(Total Unpaid)/(Total Processed)")) %>%
hc_xAxis(title = list(text = " "),type="category" )%>%
hc_tooltip(useHTML = TRUE, headerFormat = "", pointFormat = tltip)%>%
hc_title(text="Top Three Counties per State: Percent Unpaid Claims")   %>%
hc_legend(enabled = FALSE, itemStyle=list(  opacity = 0.75,fontWeight="regular"))
highchart()%>%
hc_add_series(top_five_per_state, "bar", hcaes(x = county_state,
y =percent_unpaid,group=State    )) %>%
hc_yAxis( title = list(text = "100*(Total Unpaid)/(Total Processed)"),max=100) %>%
hc_xAxis(title = list(text = " "),type="category" )%>%
hc_tooltip(useHTML = TRUE, headerFormat = "", pointFormat = tltip)%>%
hc_title(text="Top Three Counties per State: Percent Unpaid Claims")   %>%
hc_legend(enabled = FALSE, itemStyle=list(  opacity = 0.75,fontWeight="regular"))
top_five_per_state<-data.county%>%filter(percent_unpaid!="-Inf") %>% group_by(State) %>%
top_n(n = 5, wt = percent_unpaid) %>% arrange(State,desc(percent_unpaid))
#mutate(County=as.character(County))
x <- c( "State","Num. Claims Processed","Num. Claims Paid","Percent Claims Unpaid")
y <- sprintf("{point.%s}", c( "State","total_processed","total_num_paid","percent_unpaid"))
tltip <- tooltip_table(x, y)
plot2<-highchart()%>%
hc_add_series(top_five_per_state, "bar", hcaes(x = county_state,
y =percent_unpaid,color=State    )) %>%
hc_yAxis( title = list(text = "100*(Total Unpaid)/(Total Processed)"),max=100) %>%
hc_xAxis(title = list(text = " "),type="category" )%>%
hc_tooltip(useHTML = TRUE, headerFormat = "", pointFormat = tltip)%>%
hc_title(text="Top Five Counties per State: Percent of Unpaid Claims")   %>%
hc_legend(enabled = FALSE, itemStyle=list(  opacity = 0.75,fontWeight="regular")) %>% hc_add_theme(hc_theme_elementary())
plot2
highchart()%>%
hc_add_series(top_five_per_state, "bar", hcaes(x = county_state,
y =percent_unpaid,group=State    )) %>%
hc_yAxis( title = list(text = "100*(Total Unpaid)/(Total Processed)"),max=100) %>%
hc_xAxis(title = list(text = " "),type="category" )%>%
hc_tooltip(useHTML = TRUE, headerFormat = "", pointFormat = tltip)%>%
hc_title(text="Top Five Counties per State: Percent of Unpaid Claims")   %>%
hc_legend(enabled = FALSE, itemStyle=list(  opacity = 0.75,fontWeight="regular")) %>% hc_add_theme(hc_theme_elementary())
highchart()%>%
hc_add_series(top_five_per_state, "bar", hcaes(x = county_state,
y =percent_unpaid,group=State    )) %>%
hc_yAxis( title = list(text = "100*(Total Unpaid)/(Total Processed)"),max=100) %>%
hc_xAxis(title = list(text = " "),type="category" )%>%
hc_tooltip(useHTML = TRUE, headerFormat = "", pointFormat = tltip)%>%
hc_title(text="Top Five Counties per State: Percent of Unpaid Claims")   %>%
hc_legend(enabled = FALSE, itemStyle=list(  opacity = 0.75,fontWeight="regular"))# %>% hc_add_theme(hc_theme_elementary())
highchart()%>%
hc_add_series(data.county[1:25,], "column", hcaes(x = as.character(county_state),
y =percent_unpaid ,group=State   )) %>%
hc_yAxis( title = list(text = "100*(Total Unpaid)/(Total Processed)")) %>%
hc_xAxis(title = list(text = " "),type="category" )%>%
hc_tooltip(useHTML = TRUE, headerFormat = "", pointFormat = tltip)%>%
hc_plotOptions(column = list(itemStyle=list( fillOpacity = 0.1)))%>%
hc_title(text="Percent of Processed Claims that went Unpaid")   %>%
hc_legend(enabled = FALSE, itemStyle=list(  opacity = 0.75,fontWeight="regular")) #%>% hc_add_theme(hc_theme_elementary())
highchart()%>%
hc_add_series(data.county[1:25,], "column", hcaes(x = as.character(county_state),
y =percent_unpaid ,group=State   )) %>%
hc_yAxis( title = list(text = "100*(Total Unpaid)/(Total Processed)")) %>%
hc_xAxis(title = list(text = " "),type="category" )%>%
hc_tooltip(useHTML = TRUE, headerFormat = "", pointFormat = tltip)%>%
hc_plotOptions(column = list(itemStyle=list( fillOpacity = 0.1)))%>%
hc_title(text="Percent of Processed Claims that went Unpaid")   %>%
hc_legend(enabled = FALSE, itemStyle=list(  opacity = 0.75,fontWeight="regular")) #%>% hc_add_theme(hc_theme_elementary())
plot(data.clean$Processed)
RAW_PATH<-"~/Documents/2018/02_Jaafari_Proj/DATA/RAW/"
data<-read_csv(paste0(RAW_PATH,"VCAP_STATE_TOTALS_MASTER.csv"))
data<-data %>% filter(!is.na(County)) %>%
mutate(Avg_Paid=replace(Avg_Paid, Avg_Paid=='#DIV/0!', 0)) %>%
as.data.frame()
# remove characters from $$ columns and convert to numeric
data$Avg_Paid<-gsub('$','',data$Avg_Paid,fixed=TRUE)
data$Avg_Paid<-gsub(',','',data$Avg_Paid)
data$Avg_Paid<-as.numeric(as.character(data$Avg_Paid)) # as.character first to be safe.
data$Total_Paid<-gsub('$','',data$Total_Paid,fixed=TRUE)
data$Total_Paid<-gsub(',','',data$Total_Paid)
data$Total_Paid<-as.numeric(as.character(data$Total_Paid)) # as.character first to be safe.
data.clean<-data%>% filter(!is.na(County)) %>%mutate(County=replace(County,County=="Out of state","Out Of State"))%>%
mutate(County=replace(County,County=="No county","No County"))%>%
filter(!County %in% c("TOTAL"
,"Does not include claims being processed"
, "OTHER"
, "No County"
,"Out Of State"
) ) %>% data.frame()
data.county<-data.clean %>% group_by(State,County) %>%summarize(county_state=paste0(unique(County),", ",unique(State))
,avg_processed=round(mean(Processed,na.rm=TRUE),2)
, avg_num_paid=round(mean(Num_Paid,na.rm=TRUE),2)
, total_processed=sum(Processed,na.rm=TRUE)
,total_num_paid=sum(Num_Paid,na.rm=TRUE)
,percent_denied=(sum(Denied,na.rm=TRUE)+sum(Processed,na.rm=TRUE))/sum(Processed,na.rm=TRUE)
,total_denied=sum(Denied,na.rm=TRUE)
,percent_unpaid=round(100*(sum(Processed,na.rm=TRUE)-sum(Num_Paid,na.rm=TRUE))/sum(Processed,na.rm=TRUE))
) %>% filter(avg_processed>20)
data.county<-data.county %>% data.frame()%>% arrange(desc(percent_denied)) %>% mutate(county_state=factor(county_state,levels=county_state))
#%>% filter(between(row_number(), 1, 15))
View(data.county)
data.county<-data.clean %>% group_by(State,County) %>%summarize(county_state=paste0(unique(County),", ",unique(State))
,avg_processed_per_year=round(mean(Processed,na.rm=TRUE),2)
, total_processed_all_years=sum(Processed,na.rm=TRUE)
,percent_denied=(sum(Denied,na.rm=TRUE)+sum(Processed,na.rm=TRUE))/sum(Processed,na.rm=TRUE)
,total_denied=sum(Denied,na.rm=TRUE)
, avg_num_paid=round(mean(Num_Paid,na.rm=TRUE),2)
,total_num_paid=sum(Num_Paid,na.rm=TRUE)
,percent_unpaid=round(100*(sum(Processed,na.rm=TRUE)-sum(Num_Paid,na.rm=TRUE))/sum(Processed,na.rm=TRUE))
) %>% filter(avg_processed>20)
data.county<-data.county %>% data.frame()%>% arrange(desc(percent_denied)) %>% mutate(county_state=factor(county_state,levels=county_state))
#%>% filter(between(row_number(), 1, 15))
data.county<-data.clean %>% group_by(State,County) %>%summarize(county_state=paste0(unique(County),", ",unique(State))
,avg_processed_per_year=round(mean(Processed,na.rm=TRUE),2)
, total_processed_all_years=sum(Processed,na.rm=TRUE)
,percent_denied=(sum(Denied,na.rm=TRUE)+sum(Processed,na.rm=TRUE))/sum(Processed,na.rm=TRUE)
,total_denied=sum(Denied,na.rm=TRUE)
, avg_num_paid=round(mean(Num_Paid,na.rm=TRUE),2)
,total_num_paid=sum(Num_Paid,na.rm=TRUE)
,percent_unpaid=round(100*(sum(Processed,na.rm=TRUE)-sum(Num_Paid,na.rm=TRUE))/sum(Processed,na.rm=TRUE))
) %>% filter(avg_processed_per_year>20)
data.county<-data.county %>% data.frame()%>% arrange(desc(percent_denied)) %>% mutate(county_state=factor(county_state,levels=county_state))
#%>% filter(between(row_number(), 1, 15))
View(data.county)
data.county<-data.clean %>% group_by(State,County) %>%summarize(county_state=paste0(unique(County),", ",unique(State))
,avg_processed_per_year=round(mean(Processed,na.rm=TRUE),2)
, total_processed_all_years=sum(Processed,na.rm=TRUE)
,percent_denied=round(100*sum(Denied,na.rm=TRUE)/(sum(Denied,na.rm=TRUE)+sum(Processed,na.rm=TRUE)))
,total_denied=sum(Denied,na.rm=TRUE)
, avg_num_paid=round(mean(Num_Paid,na.rm=TRUE),2)
,total_num_paid=sum(Num_Paid,na.rm=TRUE)
,percent_unpaid=round(100*(sum(Processed,na.rm=TRUE)-sum(Num_Paid,na.rm=TRUE))/sum(Processed,na.rm=TRUE))
) %>% filter(avg_processed_per_year>20)
data.county<-data.county %>% data.frame()%>% arrange(desc(percent_denied)) %>% mutate(county_state=factor(county_state,levels=county_state))
#%>% filter(between(row_number(), 1, 15))
#knitr::opts_chunk$set(echo = TRUE)
library(readr)
library(tidyverse)
library(stargazer)
library(highcharter)
library(DT)
RAW_PATH<-"~/Documents/2018/02_Jaafari_Proj/DATA/RAW/"
data<-read_csv(paste0(RAW_PATH,"VCAP_STATE_TOTALS_MASTER.csv"))
data.county %>% group_by(State) %>%
top_n(n = 3, wt = percent_denied) %>% arrange(State,desc(percent_denied))
ny_denied<-data.county %>% filter(State=="New York") %>% group_by(County) %>% summarize(Total_Denied=sum(Denied,na.rm=TRUE)
,   Total_Denied_HIC=sum(Denied_HIC,na.rm=TRUE)
,Avg_Denied=mean(Denied,na.rm=TRUE)
,Avg_Denied_HIC=mean(Denied_HIC,na.rm=TRUE)
,percent_denied_HIC=round(100*sum(Denied_HIC,na.rm=TRUE)/sum(Denied,na.rm=TRUE))
)
ny_denied<-data.clean %>% filter(State=="New York") %>% group_by(County) %>% summarize(Total_Denied=sum(Denied,na.rm=TRUE)
,   Total_Denied_HIC=sum(Denied_HIC,na.rm=TRUE)
,Avg_Denied=mean(Denied,na.rm=TRUE)
,Avg_Denied_HIC=mean(Denied_HIC,na.rm=TRUE)
,percent_denied_HIC=round(100*sum(Denied_HIC,na.rm=TRUE)/sum(Denied,na.rm=TRUE))
)
ny_denied<-data.clean %>% filter(State=="New York") %>% group_by(County)
ny_denied<-data.clean %>% filter(State=="New York") %>% group_by(County) %>% mutate(Denied=as.integer(as.character(Denied))) %>%mutate(Denied_HIC=as.integer(as.character(Denied_HIC))) %>%
summarize(Total_Denied=sum(Denied,na.rm=TRUE)
,   Total_Denied_HIC=sum(Denied_HIC,na.rm=TRUE)
,Avg_Denied=mean(Denied,na.rm=TRUE)
,Avg_Denied_HIC=mean(Denied_HIC,na.rm=TRUE)
,percent_denied_HIC=round(100*sum(Denied_HIC,na.rm=TRUE)/sum(Denied,na.rm=TRUE))
)
View(ny_denied)
Loui_totals <- read_csv("/Users/MHughes/Documents/2018/02_Jaafari_Proj/DATA/RAW/Loui_totals.csv")
library(readr)
library(tidyverse)
library(stargazer)
Loui_totals <- read_csv("/Users/MHughes/Documents/2018/02_Jaafari_Proj/DATA/RAW/Loui_totals.csv")
nj_totals <- read_csv("/Users/MHughes/Documents/2018/02_Jaafari_Proj/DATA/RAW/NJ_totals.csv")
penn_totals <- read_csv("/Users/MHughes/Documents/2018/02_Jaafari_Proj/DATA/RAW/Penn_totals.csv")
View(Loui_totals)
state_totals<- read_csv("/Users/MHughes/Documents/2018/02_Jaafari_Proj/DATA/RAW/STATE_TOTALS_2010-2015.csv")
View(state_totals)
state_totals%>% group_by(State) %>% summarize(Percent_of_Denials_bc_HIC=round(100*sum(`Denied b/c HIC`,na.rm=TRUE)/sum(`Claims Denied`,na.rm=TRUE),2)
,Percent_Murder_Claims_Denied_bc_HIC=round(100*sum(`Denied b/c HIC`,na.rm=TRUE)/sum(`Murder Claims`,na.rm=TRUE))
)
percent_minority<-read_csv("/Users/MHughes/Documents/2018/02_Jaafari_Proj/DATA/RAW/CensusRacialData2013.csv")
library(readr)
library(tidyverse)
library(stargazer)
library(highcharter)
percent_minority<-read_csv("/Users/MHughes/Documents/2018/02_Jaafari_Proj/DATA/RAW/CensusRacialData2013.csv")
View(percent_minority)
percent_minority%>% mutate(percent_nonwhite=Black+Latino)
percent_minority<- percent_minority%>%  mutate(percent_nonwhite=Black+Latino)
percent_minority$minority_binned<-NULL
percent_minority$minority_binned=ifelse(percent_minority$percent_nonwhite<=25,25,percent_minority$percent_nonwhite)
percent_minority$minority_binned=ifelse(percent_minority$percent_nonwhite>25 & percent_minority$percent_nonwhite<=50 ,50,percent_minority$percent_nonwhite)
percent_minority$minority_binned=ifelse(percent_minority$percent_nonwhite>50 & percent_minority$percent_nonwhite<=75 ,75,percent_minority$percent_nonwhite)
percent_minority$minority_binned=ifelse(percent_minority$percent_nonwhite>75 & percent_minority$percent_nonwhite<=100 ,100,percent_minority$percent_nonwhite)
percent_minority$minority_binned<-NULL
percent_minority$minority_binned=ifelse(percent_minority$percent_nonwhite<=25,25,percent_minority$minority_binned)
percent_minority$minority_binned=ifelse(percent_minority$percent_nonwhite>25 & percent_minority$percent_nonwhite<=50 ,50,percent_minority$minority_binned)
percent_minority$minority_binned=ifelse(percent_minority$percent_nonwhite>50 & percent_minority$percent_nonwhite<=75 ,75,percent_minority$minority_binned)
percent_minority$minority_binned=ifelse(percent_minority$percent_nonwhite>75 & percent_minority$percent_nonwhite<=100 ,100,percent_minority$minority_binned)
percent_minority$minority_binned<-NA
percent_minority$minority_binned=ifelse(percent_minority$percent_nonwhite<=25,25,percent_minority$minority_binned)
percent_minority$minority_binned=ifelse(percent_minority$percent_nonwhite>25 & percent_minority$percent_nonwhite<=50 ,50,percent_minority$minority_binned)
percent_minority$minority_binned=ifelse(percent_minority$percent_nonwhite>50 & percent_minority$percent_nonwhite<=75 ,75,percent_minority$minority_binned)
percent_minority$minority_binned=ifelse(percent_minority$percent_nonwhite>75 & percent_minority$percent_nonwhite<=100 ,100,percent_minority$minority_binned)
#knitr::opts_chunk$set(echo = TRUE)
library(readr)
library(tidyverse)
library(stargazer)
library(highcharter)
library(DT)
RAW_PATH<-"~/Documents/2018/02_Jaafari_Proj/DATA/RAW/"
data<-read_csv(paste0(RAW_PATH,"VCAP_STATE_TOTALS_MASTER.csv"))
RAW_PATH<-"~/Documents/2018/02_Jaafari_Proj/DATA/RAW/"
data<-read_csv(paste0(RAW_PATH,"VCAP_STATE_TOTALS_MASTER.csv"))
data<-data %>% filter(!is.na(County)) %>%
mutate(Avg_Paid=replace(Avg_Paid, Avg_Paid=='#DIV/0!', 0)) %>%
as.data.frame()
# remove characters from $$ columns and convert to numeric
data$Avg_Paid<-gsub('$','',data$Avg_Paid,fixed=TRUE)
data$Avg_Paid<-gsub(',','',data$Avg_Paid)
data$Avg_Paid<-as.numeric(as.character(data$Avg_Paid)) # as.character first to be safe.
data$Total_Paid<-gsub('$','',data$Total_Paid,fixed=TRUE)
data$Total_Paid<-gsub(',','',data$Total_Paid)
data$Total_Paid<-as.numeric(as.character(data$Total_Paid)) # as.character first to be safe.
data.clean<-data%>% filter(!is.na(County)) %>%mutate(County=replace(County,County=="Out of state","Out Of State"))%>%
mutate(County=replace(County,County=="No county","No County"))%>%
filter(!County %in% c("TOTAL"
,"Does not include claims being processed"
, "OTHER"
, "No County"
,"Out Of State"
) ) %>% data.frame()
data.county<-data.clean %>% group_by(State,County) %>%summarize(county_state=paste0(unique(County),", ",unique(State))
,avg_processed_per_year=round(mean(Processed,na.rm=TRUE),2)
, total_processed_all_years=sum(Processed,na.rm=TRUE)
,percent_denied=round(100*sum(Denied,na.rm=TRUE)/(sum(Denied,na.rm=TRUE)+sum(Processed,na.rm=TRUE)))
,total_denied=sum(Denied,na.rm=TRUE)
, avg_num_paid=round(mean(Num_Paid,na.rm=TRUE),2)
,total_num_paid=sum(Num_Paid,na.rm=TRUE)
,percent_unpaid=round(100*(sum(Processed,na.rm=TRUE)-sum(Num_Paid,na.rm=TRUE))/sum(Processed,na.rm=TRUE))
) %>% filter(avg_processed_per_year>20)
data.county<-data.county %>% data.frame()%>% arrange(desc(percent_denied)) %>% mutate(county_state=factor(county_state,levels=county_state))
#%>% filter(between(row_number(), 1, 15))
View(data.clean)
View(data.county)
counties_with_race<-merge(data.county,percent_minority,by.x=c("County","State"),by.y=c("County","State"),all.x = TRUE)
View(counties_with_race)
state_denials_summary<-counties_with_race%>% filter(avg_processed_per_year>20)%>%filter(percent_denied>0)%>%group_by(State,minority_binned)%>%
summarize(Average_Percent_Denied=mean(percent_denied))
View(state_denials_summary)
counties_with_race<-merge(data.county,percent_minority,by.x=c("County","State"),by.y=c("County","State"))
state_denials_summary<-counties_with_race%>% filter(avg_processed_per_year>20)%>%filter(percent_denied>0)%>%group_by(State,minority_binned)%>%
summarize(Average_Percent_Denied=mean(percent_denied))
state_denials_summary<-counties_with_race%>% filter(avg_processed_per_year>20)%>%filter(percent_denied>0)%>%group_by(State,minority_binned)%>%
summarize(Average_Percent_Denied=round(mean(percent_denied)))
counties_with_race%>% group_by(State) %>% top_n(n = 3, wt = percent_denied) %>% arrange(State,desc(percent_denied))
counties_with_race%>% group_by(State) %>% top_n(n = 3, wt = percent_denied) %>% arrange(State,desc(percent_denied)) %>% select(County,State, minority_binned,percent_nonwhite, percent_denied)
top_three_minority_counties <- counties_with_race%>% group_by(State) %>% top_n(n = 3, wt = percent_minority) %>% arrange(State,percent_minority) %>% select(County,State, minority_binned,percent_nonwhite, percent_denied)
top_three_minority_counties <- counties_with_race%>% group_by(State) %>% top_n(n = 3, wt = percent_nonwhite) %>% arrange(State,percent_minority) %>% select(County,State, minority_binned,percent_nonwhite, percent_denied)
top_three_minority_counties <- counties_with_race%>% group_by(State) %>% top_n(n = 3, wt = percent_nonwhite) %>% arrange(State,percent_nonwhite) %>% select(County,State, minority_binned,percent_nonwhite, percent_denied)
lowest_three_minority_counties<- counties_with_race%>% group_by(State) %>% top_n(n = -3, wt = percent_nonwhite) %>% arrange(State,percent_nonwhite) %>% select(County,State, minority_binned,percent_nonwhite, percent_denied)
high_low_minority<-rbind(top_three_minority_counties,lowest_three_minority_counties)
high_low_minority<-high_low_minority%>%arrange(State,percent_nonwhite)
View(high_low_minority)
plot(counties_with_race$percent_nonwhite,counties_with_race$percent_denied)
mod<-lm(counties_with_race$percent_denied~counties_with_race$percent_nonwhite)
summary(mod)
counties_with_race2<- counties_with_race %>% filter(avg_processed_per_year>20)%>%filter(percent_denied>0)
library(tidyverse)
counties_with_race2<- counties_with_race %>% filter(avg_processed_per_year>20)%>%filter(percent_denied>0)
mod<-lm(counties_with_race2$percent_denied~counties_with_race2$percent_nonwhite)
summary(mod)
counties_with_race2<- counties_with_race %>%filter(percent_denied>0)
mod<-lm(counties_with_race2$percent_denied~counties_with_race2$percent_nonwhite)
summary(mod)
plot(counties_with_race$percent_nonwhite,counties_with_race$percent_denied)
plot(counties_with_race2$percent_nonwhite,counties_with_race2$percent_denied)
#knitr::opts_chunk$set(echo = TRUE)
library(readr)
library(tidyverse)
library(stargazer)
library(highcharter)
library(DT)
RAW_PATH<-"~/Documents/2018/02_Jaafari_Proj/DATA/RAW/"
data<-read_csv(paste0(RAW_PATH,"VCAP_STATE_TOTALS_MASTER.csv"))
percent_minority<-read_csv("/Users/MHughes/Documents/2018/02_Jaafari_Proj/DATA/RAW/CensusRacialData2013.csv")
percent_minority<- percent_minority%>%  mutate(percent_nonwhite=100-White)
percent_minority$minority_binned<-NA
percent_minority$minority_binned=ifelse(percent_minority$percent_nonwhite<=25,25,percent_minority$minority_binned)
percent_minority$minority_binned=ifelse(percent_minority$percent_nonwhite>25 & percent_minority$percent_nonwhite<=50 ,50,percent_minority$minority_binned)
percent_minority$minority_binned=ifelse(percent_minority$percent_nonwhite>50 & percent_minority$percent_nonwhite<=75 ,75,percent_minority$minority_binned)
percent_minority$minority_binned=ifelse(percent_minority$percent_nonwhite>75 & percent_minority$percent_nonwhite<=100 ,100,percent_minority$minority_binned)
counties_with_race<-merge(data.county,percent_minority,by.x=c("County","State"),by.y=c("County","State"))
state_denials_summary<-counties_with_race%>% filter(avg_processed_per_year>20)%>%filter(percent_denied>0)%>%group_by(State,minority_binned)%>%
summarize(Average_Percent_Denied=round(mean(percent_denied)))
counties_with_race2<- counties_with_race %>%filter(percent_denied>0)
mod<-lm(counties_with_race2$percent_denied~counties_with_race2$percent_nonwhite)
summary(mod)
counties_with_race2<- counties_with_race %>%filter(avg_processed_per_year>20)
mod<-lm(counties_with_race2$percent_denied~counties_with_race2$percent_nonwhite)
summary(mod)
percent_minority<-read_csv("/Users/MHughes/Documents/2018/02_Jaafari_Proj/DATA/RAW/CensusRacialData2013.csv")
percent_minority<- percent_minority%>%  mutate(percent_nonwhite=round(100-White,2))
percent_minority$minority_binned<-NA
percent_minority$minority_binned=ifelse(percent_minority$percent_nonwhite<=25,25,percent_minority$minority_binned)
percent_minority$minority_binned=ifelse(percent_minority$percent_nonwhite>25 & percent_minority$percent_nonwhite<=50 ,50,percent_minority$minority_binned)
percent_minority$minority_binned=ifelse(percent_minority$percent_nonwhite>50 & percent_minority$percent_nonwhite<=75 ,75,percent_minority$minority_binned)
percent_minority$minority_binned=ifelse(percent_minority$percent_nonwhite>75 & percent_minority$percent_nonwhite<=100 ,100,percent_minority$minority_binned)
counties_with_race<-merge(data.county,percent_minority,by.x=c("County","State"),by.y=c("County","State"))
counties_with_race<-counties_with_race%>%filter(avg_processed_per_year>20& !State %in% c("New Jersey","Pennsylvania"))
state_denials_summary<-counties_with_race %>%group_by(State,minority_binned)%>%
summarize(Average_Percent_Denied=round(mean(percent_denied)))
mod<-lm(counties_with_race$percent_denied~counties_with_race$percent_nonwhite )
summary(mod)
mod<-lm(percent_denied~percent_nonwhite +factor(State) + avg_processed_per_year,data=counties_with_race)
summary(mod)
mod<-lm(percent_denied~percent_nonwhite +factor(State) + avg_processed_per_year-1,data=counties_with_race)
summary(mod)
mod<-lm(percent_denied~percent_nonwhite +factor(State) + avg_processed_per_year,data=counties_with_race)
summary(mod)
mod<-lm(percent_denied~percent_nonwhite +factor(State) + log(avg_processed_per_year),data=counties_with_race)
summary(mod)
mod<-lm(log(percent_denied)~log(percent_nonwhite) +factor(State) + log(avg_processed_per_year),data=counties_with_race)
summary(mod)
mod<-lm(percent_denied~percent_nonwhite +factor(State) + log(avg_processed_per_year),data=counties_with_race)
summary(mod)
mod<-lm(percent_denied~percent_nonwhite +factor(State) +percent_nonwhite:factor(State) +  log(avg_processed_per_year),data=counties_with_race)
summary(mod)
mod<-lm(percent_denied~percent_nonwhite +factor(State) +  log(avg_processed_per_year),data=counties_with_race)
summary(mod)
mod2<-lm(total_denied~percent_nonwhite +factor(State) +  log(total_processed),data=counties_with_race)
mod2<-lm(total_denied~percent_nonwhite +factor(State) +  log(total_processed_all_years),data=counties_with_race)
summary(mod2)
mod2<-lm(total_denied~percent_nonwhite +factor(State) +  total_processed_all_years,data=counties_with_race)
summary(mod2)
mod2<-lm(log(total_denied)~percent_nonwhite +factor(State) +  log(total_processed_all_years),data=counties_with_race)
summary(mod2)
100*0.003899
100*0.003899*10
100*(exp(0.3899)-1)
100*(exp(0.003899)-1)
100*(exp(0.003899*10)-1)
100*(exp(0.003899)-1)*10
plot(counties_with_race$percent_nonwhite , log(counties_with_race$total_denied))
abline(lm(log(total_denied)~percent_nonwhite), col="red")
plot(percent_nonwhite , log(total_denied),data=counties_with_race)
plot(counties_with_race$percent_nonwhite , log(counties_with_race$total_denied))
abline(lm(log(counties_with_race$total_denied)~counties_with_race$percent_nonwhite), col="red")
#knitr::opts_chunk$set(echo = TRUE)
library(readr)
library(tidyverse)
library(stargazer)
library(highcharter)
library(DT)
RAW_PATH<-"~/Documents/2018/02_Jaafari_Proj/DATA/RAW/"
data<-read_csv(paste0(RAW_PATH,"VCAP_STATE_TOTALS_MASTER.csv"))
RAW_PATH<-"~/Documents/2018/02_Jaafari_Proj/DATA/RAW/"
data<-read_csv(paste0(RAW_PATH,"VCAP_STATE_TOTALS_MASTER.csv"))
length(is.na(data$County)=TRUE)
length(is.na(data$County)==TRUE)
View(data)
mod2<-lm(log(total_denied)~percent_nonwhite +factor(State) +  log(total_processed_all_years),data=counties_with_race)
percent_minority<-read_csv("/Users/MHughes/Documents/2018/02_Jaafari_Proj/DATA/RAW/CensusRacialData2013.csv")
percent_minority<- percent_minority%>%  mutate(percent_nonwhite=round(100-White,2))
percent_minority$minority_binned<-NA
percent_minority$minority_binned=ifelse(percent_minority$percent_nonwhite<=25,25,percent_minority$minority_binned)
percent_minority$minority_binned=ifelse(percent_minority$percent_nonwhite>25 & percent_minority$percent_nonwhite<=50 ,50,percent_minority$minority_binned)
percent_minority$minority_binned=ifelse(percent_minority$percent_nonwhite>50 & percent_minority$percent_nonwhite<=75 ,75,percent_minority$minority_binned)
percent_minority$minority_binned=ifelse(percent_minority$percent_nonwhite>75 & percent_minority$percent_nonwhite<=100 ,100,percent_minority$minority_binned)
counties_with_race<-merge(data.county,percent_minority,by.x=c("County","State"),by.y=c("County","State"))
counties_with_race<-counties_with_race%>%filter(avg_processed_per_year>20& !State %in% c("New Jersey","Pennsylvania"))
state_denials_summary<-counties_with_race %>%group_by(State,minority_binned)%>%
summarize(Average_Percent_Denied=round(mean(percent_denied)))
top_three_minority_counties <- counties_with_race%>% group_by(State) %>% top_n(n = 3, wt = percent_nonwhite) %>% arrange(State,percent_nonwhite) %>% select(State,County, minority_binned,Black,Latino,`Native American`,percent_nonwhite, percent_denied)
lowest_three_minority_counties<- counties_with_race%>% group_by(State) %>% top_n(n = -3, wt = percent_nonwhite) %>% arrange(State,percent_nonwhite) %>% select(State,County, minority_binned,Black,Latino,`Native American`, percent_nonwhite, percent_denied)
high_low_minority<-rbind(top_three_minority_counties,lowest_three_minority_counties)
high_low_minority<-high_low_minority%>%arrange(State,percent_nonwhite)
mod2<-lm(log(total_denied)~percent_nonwhite +factor(State) +  log(total_processed_all_years),data=counties_with_race)
summary(mod2)
mod2<-lm(log(total_denied)~percent_nonwhite +factor(State) +  log(total_processed_all_years),data=counties_with_race)
counties_with_race$predicted_log<-mod2$fitted.values
counties_with_race$est_percent_increased_denials<-100*counties_with_race$percent_nonwhite*(exp(0.003899)-1)
plot(counties_with_race$percent_nonwhite , log(counties_with_race$total_denied))
lines(counties_with_race$percent_nonwhite, est_percent_increased_denials)
counties_with_race$est_percent_increased_denials<-100*counties_with_race$percent_nonwhite*(exp(0.003899)-1)
plot(counties_with_race$percent_nonwhite , log(counties_with_race$total_denied))
lines(counties_with_race$percent_nonwhite, est_percent_increased_denials)
plot(counties_with_race$percent_nonwhite , log(counties_with_race$total_denied))
lines(counties_with_race$percent_nonwhite, counties_with_race$est_percent_increased_denials)
#abline(lm(log(counties_with_race$total_denied)~counties_with_race$percent_nonwhite), col="red")
plot(counties_with_race$percent_nonwhite, counties_with_race$est_percent_increased_denials)
plot(counties_with_race$percent_nonwhite , counties_with_race$percent_denied)
lines(counties_with_race$percent_nonwhite, counties_with_race$est_percent_increased_denials)
plot(counties_with_race$percent_nonwhite , counties_with_race$percent_denied)
lines(counties_with_race$percent_nonwhite, counties_with_race$est_percent_increased_denials,col="red")
#abline(lm(log(counties_with_race$total_denied)~counties_with_race$percent_nonwhite), col="red")
counties_with_race$est_percent_increased_denials<-100*0.003899*counties_with_race$percent_nonwhite #counties_with_race$percent_nonwhite*(exp(0.003899)-1)
plot(counties_with_race$percent_nonwhite , counties_with_race$percent_denied)
lines(counties_with_race$percent_nonwhite, counties_with_race$est_percent_increased_denials,col="red")
#abl
22/7
22/7-pi
pi-3.14
plot(counties_with_race$percent_nonwhite , counties_with_race$total_denied)
summary(mod2, robust=TRUE)
summary(mod2)#, robust=TRUE)
library(plm)
r2 <- plm(log(total_denied)~percent_nonwhite +factor(State) +  log(total_processed_all_years), model="within", x, index = c("county","Year"))
r2 <- plm(log(total_denied)~percent_nonwhite +factor(State) +  log(total_processed_all_years), model="within", x, index = c("County","Year"))
r2 <- plm(log(total_denied)~percent_nonwhite +factor(State) +  log(total_processed_all_years), model="within", data=counties_with_race, index = c("County","Year"))
View(counties_with_race)
100*(exp(0.003899)-1)
